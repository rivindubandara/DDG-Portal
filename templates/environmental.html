<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>early planning</title>
    <link
      rel="icon"
      type="image/svg"
      href="/static/images/seedling-solid.svg"
    />
    <link rel="stylesheet" href="/static/css/style.css" />
    <link
      href="https://cdn.jsdelivr.net/npm/remixicon@3.4.0/fonts/remixicon.css"
      rel="stylesheet"
    />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-ajaxtransport-xdomainrequest/1.0.4/jquery.xdomainrequest.min.js"></script>
  </head>
  <script
    async
    src="https://unpkg.com/es-module-shims@1.6.3/dist/es-module-shims.js"
  ></script>
  <script type="importmap">
    {
      "imports": {
        "three": "https://unpkg.com/three@0.151.3/build/three.module.js",
        "three/addons/": "https://unpkg.com/three@0.151.3/examples/jsm/"
      }
    }
  </script>
  <body>
    <canvas class="webgl"></canvas>

    <div class="loadingScreen"></div>

    <div class="errorPopupEnv">
      <span><img src="/static/images/emoji.png" alt="emoji" /></span>
      <p class="firstLine">OOPS...</p>
      <p class="secondLine">SOMETHING WENT WRONG</p>
      <p class="thirdLine">PLEASE TRY AGAIN OR CONTACT DDG</p>
    </div>

    <div class="sidebar">
      <div class="dd__logo">
        <a href="https://digitaldesign.nettletontribe.com.au/"
          ><img src="/static/images/dd_logo.png" alt="dd_logo" width="300px"
        /></a>
      </div>
      <div class="nt__logo">
        <a href="https://www.nettletontribe.com.au"
          ><img src="/static/images/nt_logo.png" alt="dd_logo" width="300px"
        /></a>
      </div>

      <div class="spinner" id="spinner">
        <div></div>
        <div></div>
        <div></div>
        <div></div>
        <div></div>
        <div></div>
        <div></div>
        <div></div>
        <div></div>
      </div>

      <div id="gui-container"></div>

      <nav class="sidebar__nav">
        <form
          id="environmentalForm"
          action="/submit_environmental"
          method="POST"
          enctype="multipart/form-data"
        >
          <input type="file" id="uploadedFile" name="uploadFile" />
          <label for="uploadedFile" class="uploadLabel"
            ><i class="ri-upload-line"></i>Upload 3DM</label
          >

          <div class="sliderContainer">
            <span class="sliderText">Start Day</span>
            <input
              type="range"
              min="1"
              max="31"
              id="minDay"
              name="minDay"
            />
            <span id="minDayValue" class="sliderValue">16</span>
            <span class="sliderText">End Day</span>
            <input
              type="range"
              min="1"
              max="31"
              id="maxDay"
              name="maxDay"
            />
            <span id="maxDayValue" class="sliderValue">16</span>
            <span class="sliderText">Start Month</span>
            <input
              type="range"
              min="1"
              max="12"
              id="minMonth"
              name="minMonth"
            />
            <span id="minMonthValue" class="sliderValue">7</span>
            <span class="sliderText">End Month</span>
            <input
              type="range"
              min="1"
              max="12"
              id="maxMonth"
              name="maxMonth"
            />
            <span id="maxMonthValue" class="sliderValue">7</span>
          </div>

          <div class="submitContainer">
            <button id="submitBtn" type="submit">
              <i class="ri-send-plane-line"></i>Compute
            </button>
          </div>
        </form>

        <div class="resultsEnvContainer">
          <i class="ri-numbers-fill"></i>Results
          <h5>Total Sunlight Hours</h5>
          <p>{{ total_sunlight_hours }}</p>
        </div>

        <ul class="sidebar__menu">
          <li>
            <a href="{{ url_for('planning') }}"
              ><img
                src="/static/images/building-solid.svg"
                alt="building icon"
              />
              <p>PLANNING</p></a
            >
          </li>
          <li>
            <a href="{{ url_for('carbon') }}"
              ><img
                src="/static/images/industry-solid.svg"
                alt="industrial icon"
              />
              <p>CARBON</p></a
            >
          </li>
          <li>
            <a href="{{ url_for('environmental') }}"
              ><img src="/static/images/seedling-solid.svg" alt="tree icon" />
              <p>ENVIRONMENTAL</p></a
            >
          </li>
        </ul>
      </nav>
    </div>

    <script>
      const minDaySlider = document.getElementById("minDay");
      const maxDaySlider = document.getElementById("maxDay");
      const minMonthSlider = document.getElementById("minMonth");
      const maxMonthSlider = document.getElementById("maxMonth");

      const minDayValue = document.getElementById("minDayValue");
      const maxDayValue = document.getElementById("maxDayValue");
      const minMonthValue = document.getElementById("minMonthValue");
      const maxMonthValue = document.getElementById("maxMonthValue");

      minDaySlider.addEventListener("input", function () {
        minDayValue.textContent = minDaySlider.value;
      });

      maxDaySlider.addEventListener("input", function () {
        maxDayValue.textContent = maxDaySlider.value;
      });

      minMonthSlider.addEventListener("input", function () {
        minMonthValue.textContent = minMonthSlider.value;
      });

      maxMonthSlider.addEventListener("input", function () {
        maxMonthValue.textContent = maxMonthSlider.value;
      });
    </script>

    <script>
      $(document).ready(function () {
        $(".errorPopup").click(function () {
          $(this).hide();
        });
      });
    </script>

    <script>
      document
        .getElementById("uploadedFile")
        .addEventListener("change", function () {
          if (this.value) {
            document.querySelector(".uploadLabel").classList.add("green");
          } else {
            document.querySelector(".uploadLabel").classList.remove("green");
          }
        });
    </script>

    <script>
      $(document).ready(function () {
        $("#environmentalForm").on("submit", function (event) {
          event.preventDefault();

          $(".spinner").css("display", "block");

          var formData = new FormData(this);

          $.ajax({
            type: "POST",
            url: "/submit_environmental",
            data: formData,
            processData: false,
            contentType: false,
            dataType: "binary",
            xhrFields: {
              responseType: "blob",
            },
            success: function (response) {
              var blob = new Blob([response]);
              var link = document.createElement("a");
              link.href = window.URL.createObjectURL(blob);
              link.download = "environmental.3dm";
              link.click();

              $(".spinner").css("display", "none");

              location.reload();
            },
            error: function () {
              $(".spinner").css("display", "none");
              $(".errorPopup").css("display", "flex");
            },
          });
        });
      });
    </script>

    <script>
      var minDay = document.getElementById("minDay").value;
      var maxDay = document.getElementById("maxDay").value;
      var minMonth = document.getElementById("minMonth").value;
      var maxMonth = document.getElementById("maxMonth").value;
    </script>

    <script
      type="module"
      src="{{ url_for('static', filename='js/3dm.js') }}"
    ></script>

    <script type="text/javascript">
      document.onreadystatechange = function () {
          if (document.readyState !== "complete") {
              setTimeout(function(){
                  document.querySelector(".loadingScreen").style.display = "none";
              }, 3000);
          }
      };
    </script>

  </body>
</html>
