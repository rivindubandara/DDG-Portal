<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>nettletontribe</title>
    <link
      rel="icon"
      type="image/svg"
      href="/static/images/building-2-line.svg"
    />
    <link rel="stylesheet" href="/static/css/style.css" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-ajaxtransport-xdomainrequest/1.0.4/jquery.xdomainrequest.min.js"></script>
    <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.7.0/mapbox-gl-geocoder.min.js"></script>
    <link
      rel="stylesheet"
      href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.7.0/mapbox-gl-geocoder.css"
      type="text/css"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/remixicon@3.4.0/fonts/remixicon.css"
      rel="stylesheet"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.1/gsap.min.js"></script>
    <script src='https://api.mapbox.com/mapbox-gl-js/v3.0.0-beta.1/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v3.0.0-beta.1/mapbox-gl.css' rel='stylesheet' />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.1/gsap.min.js"></script>
  </head>
  <body>

    <div class="legend">
      <div class="legend-item">
        <a href="https://www.callisonrtkl.com/climate-scout/zone/af_tropical-rainforest/" target="_blank">
          <div class="color-box" style="background-color: #0000ff;"></div>
          Tropical Rainforest (Af)
        </a>
      </div>
      <div class="legend-item">
        <a href="https://www.callisonrtkl.com/climate-scout/zone/am_tropical-monsoon/" target="_blank">
          <div class="color-box" style="background-color: #0077ff;"></div>
          Tropical Monsoon (Am)
        </a>
      </div>
      <div class="legend-item">
        <a href="https://www.callisonrtkl.com/climate-scout/zone/as_tropical-savanna-dry-summer/", target="_blank">
          <div class="color-box" style="background-color: #46a9fa;"></div>
          Tropical Savanna, Dry Summer (As)
        </a>
      </div>
      <div class="legend-item">
        <a href="https://www.callisonrtkl.com/climate-scout/zone/aw_tropical-savanna-dry-winter/" target="_blank">
          <div class="color-box" style="background-color: #46a9fa;"></div>
          Tropical Savanna, Dry Winter (Aw)
        </a>
      </div>
      <div class="legend-item">
        <a href="https://www.callisonrtkl.com/climate-scout/zone/bsh_hot-semi-arid/">
          <div class="color-box" style="background-color: #f5a300;"></div>
          Hot Semi-Arid (BSh)
        </a>
      </div>
      <div class="legend-item">
        <a href="https://www.callisonrtkl.com/climate-scout/zone/bsk_cold-semi-arid/" target="_blank">
          <div class="color-box" style="background-color: #ffdb63;"></div>
          Cold Semi-Arid (BSk)
        </a>
      </div>
      <div class="legend-item">
        <a href="https://www.callisonrtkl.com/climate-scout/zone/bwh_hot-desert/" target="_blank">
          <div class="color-box" style="background-color: #ff0000;"></div>
          Hot Desert (BWh)
        </a>
      </div>
      <div class="legend-item">
        <a href="https://www.callisonrtkl.com/climate-scout/zone/bwk_cold-desert/" target="_blank">
          <div class="color-box" style="background-color: #ff9696;"></div>
          Cold Desert (BWk)
        </a>
      </div>
      <div class="legend-item">
        <a href="https://www.callisonrtkl.com/climate-scout/zone/cfa_humid-subtropical/" target="_blank">
          <div class="color-box" style="background-color: #c7ff4f;"></div>
          Humid Subtropical (Cfa)
        </a>
      </div>
      <div class="legend-item">
        <a href="https://www.callisonrtkl.com/climate-scout/zone/cfb_temperate-oceanic/" target="_blank">
          <div class="color-box" style="background-color: #66ff33;"></div>
          Temperate Oceanic (Cfb)
        </a>
      </div>
      <div class="legend-item">
        <a href="https://www.callisonrtkl.com/climate-scout/zone/cfc_subpolar-oceanic/" target="_blank">
          <div class="color-box" style="background-color: #32c700;"></div>
          Subpolar Oceanic (Cfc)
        </a>
      </div>
      <div class="legend-item">
        <a href="https://www.callisonrtkl.com/climate-scout/zone/csa_hot-summer-mediterranean/" target="_blank">
          <div class="color-box" style="background-color: #ffff00;"></div>
          Hot-summer Mediterranean (Csa)
        </a>
      </div>
      <div class="legend-item">
        <a href="https://www.callisonrtkl.com/climate-scout/zone/csb_warm-summer-mediterranean/" target="_blank">
          <div class="color-box" style="background-color: #c7c700;"></div>
          Warm-summer Mediterranean (Csb)
        </a>
      </div>
      <div class="legend-item">
        <a href="https://www.callisonrtkl.com/climate-scout/zone/csc_cold-summer-mediterranean/" target="_blank">
          <div class="color-box" style="background-color: #969600;"></div>
          Cold-summer Mediterranean (Csc)
        </a>
      </div>
      <div class="legend-item">
        <a href="https://www.callisonrtkl.com/climate-scout/zone/cwa_monsoon-influenced-humid-subtropical/" target="_blank">
          <div class="color-box" style="background-color: #96ff96;"></div>
          Monsoon-influenced Humid Subtropical (Cwa)
        </a>
      </div>
      <div class="legend-item">
        <a href="https://www.callisonrtkl.com/climate-scout/zone/cwb_subtropical-highland/" target="_blank">
          <div class="color-box" style="background-color: #63c763;"></div>
          Subtropical Highland (Cwb)
        </a>
      </div>
      <div class="legend-item">
        <a href="https://www.callisonrtkl.com/climate-scout/zone/cwc_cold-subtropical-highland/" target="_blank">
          <div class="color-box" style="background-color: #329632;"></div>
          Cold Subtropical Highland (Cwc)
        </a>
      </div>
      <div class="legend-item">
        <a href="https://www.callisonrtkl.com/climate-scout/zone/dfa_hot-summer-humid-continental/" target="_blank">
          <div class="color-box" style="background-color: #00ffff;"></div>
          Hot-summer Humid Continental (Dfa)
        </a>
      </div>
      <div class="legend-item">
        <a href="https://www.callisonrtkl.com/climate-scout/zone/dfb_warm-summer-humid-continental/" target="_blank">
          <div class="color-box" style="background-color: #38c7ff;"></div>
          Warm-summer Humid Continental (Dfb)
        </a>
      </div>
      <div class="legend-item">
        <a href="https://www.callisonrtkl.com/climate-scout/zone/dfc_subarctic/" target="_blank">
          <div class="color-box" style="background-color: #007d7d;"></div>
          Subarctic (Dfc)
        </a>
      </div>
      <div class="legend-item">
        <a href="https://www.callisonrtkl.com/climate-scout/zone/dfd_extremely-cold-subarctic/" target="_blank">
          <div class="color-box" style="background-color: #00455e;"></div>
          Extremely Cold Subarctic (Dfd)
        </a>
      </div>
      <div class="legend-item">
        <a href="https://www.callisonrtkl.com/climate-scout/zone/dsa_mediterranean-influenced-hot-summer-humid-continental/" target="_blank">
          <div class="color-box" style="background-color: #ff00ff;"></div>
          Mediterranean-influenced Hot-summer Humid Continental (Dsa)
        </a>
      </div>
      <div class="legend-item">
        <a href="https://www.callisonrtkl.com/climate-scout/zone/dsb_mediterranean-influenced-warm-summer-humid-continental/" target="_blank">
          <div class="color-box" style="background-color: #c700c7;"></div>
          Mediterranean-influenced Warm-summer Humid Continental (Dsb)
        </a>
      </div>
      <div class="legend-item">
        <a href="https://www.callisonrtkl.com/climate-scout/zone/dsc_mediterranean-influenced-subarctic/" target="_blank">
          <div class="color-box" style="background-color: #963296;"></div>
          Mediterranean-influenced Subarctic (Dsc)
        </a>
      </div>
      <div class="legend-item">
        <a href="https://www.callisonrtkl.com/climate-scout/zone/dsd_mediterranean-influenced-extremely-cold-subarctic/" target="_blank">
          <div class="color-box" style="background-color: #966596;"></div>
          Mediterranean-influenced Extremely Cold Subarctic (Dsd)
        </a>
      </div>
      <div class="legend-item">
        <a href="https://www.callisonrtkl.com/climate-scout/zone/dwa_monsoon-influenced-hot-summer-humid-continental/" target="_blank">
          <div class="color-box" style="background-color: #abb0ff;"></div>
          Monsoon-influenced Hot-summer Humid Continental (Dwa)
        </a>
      </div>
      <div class="legend-item">
        <a href="https://www.callisonrtkl.com/climate-scout/zone/dwb_monsoon-influenced-warm-summer-humid-continental/" target="_blank">
          <div class="color-box" style="background-color: #5a78db;"></div>
          Monsoon-influenced Warm-summer Humid Continental (Dwb)
        </a>
      </div>
      <div class="legend-item">
        <a href="https://www.callisonrtkl.com/climate-scout/zone/dwc_monsoon-influenced-subarctic/" target="_blank">
          <div class="color-box" style="background-color: #32c700;"></div>
          Monsoon-influenced Subarctic (Dwc)
        </a>
      </div>
      <div class="legend-item">
        <a href="https://www.callisonrtkl.com/climate-scout/zone/dwd_monsoon-influenced-extremely-cold-subarctic/" target="_blank">
          <div class="color-box" style="background-color: #320087;"></div>
          Monsoon-influenced Extremely Cold Subarctic (Dwd)
        </a>
      </div>
      <div class="legend-item">
        <a href="https://www.callisonrtkl.com/climate-scout/zone/ef_ice-cap/" target="_blank">
          <div class="color-box" style="background-color: #686868;"></div>
          Ice Cap (EF)
        </a>
      </div>
      <div class="legend-item">
        <a href="https://www.callisonrtkl.com/climate-scout/zone/et_tundra/" target="_blank">
          <div class="color-box" style="background-color: #b2b2b2;"></div>
          Tundra (ET)
        </a>
      </div>
    </div>

    <div class="statePicker">
      <ul>
        <li>
          <img
            src="/static/images/nsw_outline.png"
            alt=""
            class="state-img nsw-img"
          />
        </li>
        <li>
          <a href="{{ url_for('qld') }}" onclick="hideStatePicker()"
            ><img
              src="/static/images/qld_outline.png"
              alt=""
              class="state-img qld-img"
          /></a>
        </li>
        <li>
          <a href="{{ url_for('vic') }}" onclick="hideStatePicker()"
            ><img
              src="/static/images/vic_outline.png"
              alt=""
              class="state-img vic-img"
          /></a>
        </li>
        <li>
          <a href="{{ url_for('tas') }}" onclick="hideStatePicker()"
            ><img
              src="/static/images/tas_outline.png"
              alt=""
              class="state-img tas-img"
          /></a>
        </li>  
      </ul>
    </div>

    <div class="planningloader" id="planningPreloader">
      <div class="planning-logo-container">
        <img src="/static/images/dd_logo.png" alt="Logo">
      </div>
    </div>

    <div class="state">
      <a href="./planning"
        ><img src="/static/images/nsw_outline.png" alt=""
      /></a>
    </div>

    <div class="errorPopup">
      <span><img src="/static/images/emoji.png" alt="emoji" /></span>
      <p class="firstLine">OOPS...</p>
      <p class="secondLine">SOMETHING WENT WRONG</p>
      <p class="thirdLine">PLEASE TRY AGAIN OR CONTACT DDG</p>
    </div>

    <form
      id="rhinoForm"
      action="/mergeRhino"
      enctype="multipart/form-data"
      ,
      method="POST"
    >
      <div class="mergeRhino">
        <input
          type="file"
          id="uploadedMergeFile"
          name="uploadedMergeFile"
          multiple
          onchange="countFiles()"
        />
        <label for="uploadedMergeFile" class="uploadMergeLabel"
          ><img src="/static/images/rhino.png" alt="rhino" width="50px"></label
        >
        <span id="fileCount">0</span>
        <button type="submit" class="mergeLabel"><img src="/static/images/merge.png" alt="merge" width="25px" ></button>
      </div>
    </form>

    <div class="dd__logo">
      <a href="https://digitaldesign.nettletontribe.com.au/"
        ><img src="/static/images/dd_logo.png" alt="dd_logo" width="200px"
      /></a>
    </div>

    <div class="nt__logo">
      <a href="https://www.nettletontribe.com.au/"
        ><img src="/static/images/nt_logo.png" alt="dd_logo" width="200px"
      /></a>
    </div>

    <form id="speckleForm" action="/submit/speckle" method="POST">
      <div class="address">
        <input
          type="text"
          id="address_speckle"
          name="address"
          placeholder="Address will appear here"
          readonly
        />
      </div>
      <div class="speckle_button">
        <button type="submit" id="speckle"></button>
        <label for="speckle" class="speckleLabel"><img src="/static/images/speckle.png" alt="speckle" width="40px"></label>
      </div>
    </form>

    <form id="imagesForm" action="/submit/images" method="POST">
      <div class="address">
        <input
          type="text"
          id="address_images"
          name="address"
          placeholder="Address will appear here"
          readonly
        />
      </div>
      <div class="images_button">
        <button type="submit" id="images"></button>
        <label for="images" class="imagesLabel"><img src="/static/images/gallery.png" alt="image" width="40px"></label>
      </div>
    </form>

    <div class="sidebar">

      <nav class="sidebar__nav">
        <form id="planningForm" action="/submit/planning" method="POST">
          <div class="address">
            <input
              type="text"
              id="address_planning"
              name="address"
              placeholder="ADDRESS WILL APPEAR HERE"
              readonly
            />
          </div>
          <div class="planning_button">
            <button type="submit" id="planning"></button>
            <label for="planning" class="planningLabel">PLANNING</label>
          </div>
        </form>
        <form id="geometryForm" action="/submit/geometry" method="POST">
          <input type="file" id="uploadGiraffeBtn" name="uploadGiraffeBtn" />
          <label for="uploadGiraffeBtn" class="uploadGiraffeLabel"
            ><img src="/static/images/giraffe.png" alt="giraffe" width="40px"></label
          >
          <div class="address">
            <input
              type="text"
              id="address_geometry"
              name="address"
              placeholder="Address will appear here"
              readonly
            />
          </div>
          <div class="geometry_button">
            <button type="submit" id="geometry"></button>
            <label for="geometry" class="geometryLabel">GEOMETRY</label>
          </div>
        </form>
        <form id="elevatedForm" action="/submit/elevated" method="POST">
          <div class="address">
            <input
              type="text"
              id="address_elevated"
              name="address"
              placeholder="Address will appear here"
              readonly
            />
          </div>
          <div class="elevated_button">
            <button type="submit" id="elevated"></button>
            <label for="elevated" class="elevatedLabel">ELEVATED</label>
          </div>
        </form>

        <form id="liteForm" action="/submit/lite" method="POST">
          <div class="address">
            <input
              type="text"
              id="address_lite"
              name="address"
              placeholder="Address will appear here"
              readonly
            />
          </div>
          <div class="lite_button">
            <button type="submit" id="lite"></button>
            <label for="lite" class="liteLabel">LITE</label>
          </div>
        </form>

        <div class="spinner" id="spinner">
          <div></div>
          <div></div>
          <div></div>
          <div></div>
          <div></div>
          <div></div>
          <div></div>
          <div></div>
          <div></div>
        </div>

        <div class="togglecontainer">
          <div id="adminToggle" class="toggle">
            <div class="toggle-button" onclick="Animatedtoggle(this)">
              <div class="toggle-text">SUBURBS</div>
            </div>
          </div>

          <div id="cadastreToggle" class="toggle">
            <div class="toggle-button" onclick="Animatedtoggle(this)">
              <div class="toggle-text">CADASTRE</div>
            </div>
          </div>

          <div id="landZoningToggle" class="toggle">
            <div class="toggle-button" onclick="Animatedtoggle(this)">
              <div class="toggle-text">ZONING</div>
            </div>
          </div>

          <div id="fsrToggle" class="toggle">
            <div class="toggle-button" onclick="Animatedtoggle(this)">
              <div class="toggle-text">FSR</div>
            </div>
          </div>

          <div id="mlsToggle" class="toggle">
            <div class="toggle-button" onclick="Animatedtoggle(this)">
              <div class="toggle-text">LOT SIZE</div>
            </div>
          </div>

          <div id="hobToggle" class="toggle">
            <div class="toggle-button" onclick="Animatedtoggle(this)">
              <div class="toggle-text">BUILDING HEIGHT</div>
            </div>
          </div>

          <div id="bushfireToggle" class="toggle">
            <div class="toggle-button" onclick="Animatedtoggle(this)">
              <div class="toggle-text">BUSHFIRE</div>
            </div>
          </div>

          <div id="heritageToggle" class="toggle">
            <div class="toggle-button" onclick="Animatedtoggle(this)">
              <div class="toggle-text">HERITAGE</div>
            </div>
          </div>

          <div id="buildingsToggle" class="toggle">
            <div class="toggle-button" onclick="Animatedtoggle(this)">
              <div class="toggle-text">BUILDINGS</div>
            </div>
          </div>

          <div id="nativelandsToggle" class="toggle">
            <div class="toggle-button" onclick="Animatedtoggle(this)">
              <div class="toggle-text">NATIVE LAND</div>
            </div>
          </div>

          <div id="satelliteToggle" class="toggle">
            <div class="toggle-button" onclick="Animatedtoggle(this)">
              <div class="toggle-text">SATELLITE</div>
            </div>
          </div>

          <div id="valuationToggle" class="toggle">
            <div class="toggle-button" onclick="Animatedtoggle(this)">
              <div class="toggle-text">VALUATION</div>
            </div>
          </div>

          <div id="climatezoneToggle" class="toggle">
            <div class="toggle-button" onclick="Animatedtoggle(this)">
              <div class="toggle-text">CLIMATE ZONE</div>
            </div>
          </div>

        </div>

        <ul class="sidebar__menu">
          <li>
            <a href="{{ url_for('planning') }}"
              ><img
                src="/static/images/building-solid.svg"
                alt="building icon"
              />
              <p>PLANNING</p></a
            >
          </li>
          <li>
            <a href="{{ url_for('carbon') }}"
              ><img
                src="/static/images/industry-solid.svg"
                alt="industrial icon"
              />
              <p>CARBON</p></a
            >
          </li>
          <li>
            <a href="{{ url_for('environmental') }}"
              ><img src="/static/images/seedling-solid.svg" alt="tree icon" />
              <p>ENVIRONMENTAL</p></a
            >
          </li>
        </ul>
      </nav>
    </div>

    <section id="container">
      <div id="map"></div>
    </section>

    <div id="infoBox">
      <div id="cadastreInfo"></div>
      <div id="adminInfo"></div>
      <div id="zoningInfo"></div>
      <div id="fsrInfo"></div>
      <div id="hobInfo"></div>
      <div id="mlsInfo"></div>
    </div>

    <script>
      let toggle = document.querySelector(".toggle");
      let text = document.querySelector(".text");

      function Animatedtoggle(clickedElement) {
        const toggle = clickedElement.parentNode;
        const text = toggle.nextElementSibling;

        toggle.classList.toggle("active");
      }
    </script>

    <script>
      $(document).ready(function () {
        $(".errorPopup").click(function () {
          $(this).hide();
        });
      });
    </script>

    <script>
      gsap.to(".planningloader", {
        duration: 3,
        y: "-100%",
        ease: "power4.inOut",
      });
    </script>

    <script>
      $(document).ready(function () {
        $("#rhinoForm").on("submit", function (event) {
          event.preventDefault();

          $(".spinner").css("display", "block");

          var formData = new FormData(this);

          $.ajax({
            type: "POST",
            url: "/mergeRhino",
            data: formData,
            processData: false,
            contentType: false,
            dataType: "binary",
            xhrFields: {
              responseType: "blob",
            },
            success: function (response) {
              var blob = new Blob([response]);
              var link = document.createElement("a");
              link.href = window.URL.createObjectURL(blob);
              link.download = "merged.3dm";
              link.click();

              $(".spinner").css("display", "none");
            },
            error: function () {
              $(".spinner").css("display", "none");
              $(".errorPopup").css("display", "flex");
            },
          });
        });
      });
    </script>

    <script>
      $(document).ready(function () {
        $("#imagesForm").on("submit", function (event) {
          event.preventDefault();

          $(".spinner").css("display", "block");

          var formData = new FormData(this);

          $.ajax({
            type: "POST",
            url: "/submit/images",
            data: formData,
            processData: false,
            contentType: false,
            dataType: "binary",
            xhrFields: {
              responseType: "blob",
            },
            success: function (response) {
              var blob = new Blob([response]);
              var link = document.createElement("a");
              link.href = window.URL.createObjectURL(blob);
              link.download = 'zipfile.zip';
              link.click();

              $(".spinner").css("display", "none");

            },
            error: function () {
              $(".spinner").css("display", "none");
              $(".errorPopup").css("display", "flex");
            },
          });
        });
      });
      </script>

    <script>
      $(document).ready(function () {
        $("#planningForm").on("submit", function (event) {
          event.preventDefault();

          $(".spinner").css("display", "block");

          var formData = new FormData(this);

          $.ajax({
            type: "POST",
            url: "/submit/planning",
            data: formData,
            processData: false,
            contentType: false,
            dataType: "binary",
            xhrFields: {
              responseType: "blob",
            },
            success: function (response) {
              var blob = new Blob([response]);
              var link = document.createElement("a");
              link.href = window.URL.createObjectURL(blob);
              link.download = "planning.3dm";
              link.click();

              $(".spinner").css("display", "none");
            },
            error: function () {
              $(".spinner").css("display", "none");
              $(".errorPopup").css("display", "flex");
            },
          });
        });
      });
    </script>

    <script>
      $(document).ready(function () {
        $("#speckleForm").on("submit", function (event) {
          event.preventDefault();

          $(".spinner").css("display", "block");

          var formData = new FormData(this);

          $.ajax({
              type: "POST",
              url: "/submit/speckle",
              data: formData,
              processData: false,
              contentType: false,
              dataType: "json",
              success: function (response) {
                  var new_stream_id = response.stream_id;
                  var stream_url = 'https://speckle.xyz/streams/' + new_stream_id;

                  window.open(stream_url, '_blank');

                  $(".spinner").css("display", "none");
              },
              error: function () {
                  $(".spinner").css("display", "none");
                  $(".errorPopup").css("display", "flex");
              },
          });
        });
      });
    </script>

    <script>
      $(document).ready(function () {
        $("#geometryForm").on("submit", function (event) {
          event.preventDefault();

          $(".spinner").css("display", "block");

          var formData = new FormData(this);

          $.ajax({
            type: "POST",
            url: "/submit/geometry",
            data: formData,
            processData: false,
            contentType: false,
            dataType: "binary",
            xhrFields: {
              responseType: "blob",
            },
            success: function (response) {
              var blob = new Blob([response]);
              var link = document.createElement("a");
              link.href = window.URL.createObjectURL(blob);
              link.download = "geometry.3dm";
              link.click();

              $(".spinner").css("display", "none");
            },
            error: function () {
              $(".spinner").css("display", "none");
              $(".errorPopup").css("display", "flex");
            },
          });
        });
      });
    </script>

    <script>
      $(document).ready(function () {
        $("#elevatedForm").on("submit", function (event) {
          event.preventDefault();

          $(".spinner").css("display", "block");

          var formData = new FormData(this);

          $.ajax({
            type: "POST",
            url: "/submit/elevated",
            data: formData,
            processData: false,
            contentType: false,
            dataType: "binary",
            xhrFields: {
              responseType: "blob",
            },
            success: function (response) {
              var blob = new Blob([response]);
              var link = document.createElement("a");
              link.href = window.URL.createObjectURL(blob);
              link.download = "elevated.3dm";
              link.click();

              $(".spinner").css("display", "none");
            },
            error: function () {
              $(".spinner").css("display", "none");
              $(".errorPopup").css("display", "flex");
            },
          });
        });
      });
    </script>

    <script>
      $(document).ready(function () {
        $("#liteForm").on("submit", function (event) {
          event.preventDefault();

          $(".spinner").css("display", "block");

          var formData = new FormData(this);

          $.ajax({
            type: "POST",
            url: "/submit/lite",
            data: formData,
            processData: false,
            contentType: false,
            dataType: "binary",
            xhrFields: {
              responseType: "blob",
            },
            success: function (response) {
              var blob = new Blob([response]);
              var link = document.createElement("a");
              link.href = window.URL.createObjectURL(blob);
              link.download = "lite.3dm";
              link.click();

              $(".spinner").css("display", "none");
            },
            error: function () {
              $(".spinner").css("display", "none");
              $(".errorPopup").css("display", "flex");
            },
          });
        });
      });
    </script>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        var statePicker = document.querySelector(".statePicker");
        var nswLink = statePicker.querySelector("li:first-child");
        var stateLinks = statePicker.querySelectorAll("a");

        function hideStatePicker() {
          statePicker.classList.add("hidden");
        }

        nswLink.addEventListener("click", hideStatePicker);
        stateLinks.forEach(function (link) {
          link.addEventListener("click", hideStatePicker);
        });
      });
    </script>

    <script>
      mapboxgl.accessToken =
        "pk.eyJ1Ijoicml2aW5kdWIiLCJhIjoiY2xmYThkcXNjMHRkdDQzcGU4Mmh2a3Q3MSJ9.dXlhamKyYyGusL3PWqDD9Q";
      var lat = "{{ lat }}";
      var lon = "{{ lon }}";

      const map = new mapboxgl.Map({
        container: "map",
        center: [lon, lat],
        zoom: 10,
      });

      map.on('style.load', () => {
        map.setConfigProperty('basemap', 'lightPreset', 'dusk');
        });


      function queryCadastreLayer(lat, lon) {
        var queryUrl =
          "https://maps.six.nsw.gov.au/arcgis/rest/services/sixmaps/Cadastre/MapServer/0/query";
        var params = {
          distance: 10,
          units: "esriSRUnit_Meter",
          geometry: lon + "," + lat,
          geometryType: "esriGeometryPoint",
          inSR: 4326,
          spatialRel: "esriSpatialRelIntersects",
          returnGeometry: true,
          returnTrueCurves: false,
          returnIdsOnly: false,
          returnCountOnly: false,
          returnZ: false,
          returnM: false,
          returnDistinctValues: false,
          returnExtentsOnly: false,
          outFields: "*",
          f: "geojson",
        };

        $.ajax({
          url: queryUrl,
          data: params,
          dataType: "json",
          success: function (response) {
            var featureInfoElement = document.getElementById("cadastreInfo");

            featureInfoElement.innerHTML = "";

            if (response.features.length > 0) {
              var feature = response.features[0];
              var properties = feature.properties;
              var featureContainer = document.createElement("div");
              featureContainer.className = "feature-container";

              var featureTitle = document.createElement("p");
              featureTitle.textContent = "LOT ID: " + properties.lotidstring;

              featureContainer.appendChild(featureTitle);

              featureInfoElement.appendChild(featureContainer);

              featureInfoElement.style.display = "block";
            } else {
            }
          }
        });
      }

      function queryAdminLayer(lat, lon) {
        var queryUrl =
          "https://maps.six.nsw.gov.au/arcgis/rest/services/public/NSW_Administrative_Boundaries/MapServer/0/query";
        var params = {
          distance: 10,
          units: "esriSRUnit_Meter",
          geometry: lon + "," + lat,
          geometryType: "esriGeometryPoint",
          inSR: 4326,
          spatialRel: "esriSpatialRelIntersects",
          returnGeometry: true,
          returnTrueCurves: false,
          returnIdsOnly: false,
          returnCountOnly: false,
          returnZ: false,
          returnM: false,
          returnDistinctValues: false,
          returnExtentsOnly: false,
          outFields: "*",
          f: "geojson",
        };

        $.ajax({
          url: queryUrl,
          data: params,
          dataType: "json",
          success: function (response) {
            var featureInfoElement = document.getElementById("adminInfo");

            featureInfoElement.innerHTML = "";

            if (response.features.length > 0) {
              var feature = response.features[0];
              var properties = feature.properties;
              var featureContainer = document.createElement("div");
              featureContainer.className = "feature-container";

              var featureTitle = document.createElement("p");
              featureTitle.textContent = "SUBURB: " + properties.suburbname;

              featureContainer.appendChild(featureTitle);

              featureInfoElement.appendChild(featureContainer);

              featureInfoElement.style.display = "block";
            } else {
            }
          }
        });
      }

      function queryZoningLayer(lat, lon) {
        var queryUrl =
          "https://mapprod1.environment.nsw.gov.au/arcgis/rest/services/Planning/EPI_Primary_Planning_Layers/MapServer/2/query";
        var params = {
          distance: 10,
          units: "esriSRUnit_Meter",
          geometry: lon + "," + lat,
          geometryType: "esriGeometryPoint",
          inSR: 4326,
          spatialRel: "esriSpatialRelIntersects",
          returnGeometry: true,
          returnTrueCurves: false,
          returnIdsOnly: false,
          returnCountOnly: false,
          returnZ: false,
          returnM: false,
          returnDistinctValues: false,
          returnExtentsOnly: false,
          outFields: "*",
          f: "geojson",
        };

        $.ajax({
          url: queryUrl,
          data: params,
          dataType: "json",
          success: function (response) {
            var featureInfoElement = document.getElementById("zoningInfo");

            featureInfoElement.innerHTML = "";

            if (response.features.length > 0) {
              var feature = response.features[0];
              var properties = feature.properties;
              var featureContainer = document.createElement("div");
              featureContainer.className = "feature-container";

              var featureTitle = document.createElement("p");
              featureTitle.textContent = "ZONING: " + properties.SYM_CODE;

              featureContainer.appendChild(featureTitle);

              featureInfoElement.appendChild(featureContainer);

              featureInfoElement.style.display = "block";
            } else {
            }
          }
        });
      }

      function queryFSRLayer(lat, lon) {
        var queryUrl =
          "https://mapprod3.environment.nsw.gov.au/arcgis/rest/services/Planning/Principal_Planning_Layers/MapServer/4/query";
        var params = {
          distance: 10,
          units: "esriSRUnit_Meter",
          geometry: lon + "," + lat,
          geometryType: "esriGeometryPoint",
          inSR: 4326,
          spatialRel: "esriSpatialRelIntersects",
          returnGeometry: true,
          returnTrueCurves: false,
          returnIdsOnly: false,
          returnCountOnly: false,
          returnZ: false,
          returnM: false,
          returnDistinctValues: false,
          returnExtentsOnly: false,
          outFields: "*",
          f: "geojson",
        };

        $.ajax({
          url: queryUrl,
          data: params,
          dataType: "json",
          success: function (response) {
            var featureInfoElement = document.getElementById("fsrInfo");

            featureInfoElement.innerHTML = "";

            if (response.features.length > 0) {
              var feature = response.features[0];
              var properties = feature.properties;
              var featureContainer = document.createElement("div");
              featureContainer.className = "feature-container";

              var featureTitle = document.createElement("p");
              featureTitle.textContent = "FSR: " + properties.FSR;

              featureContainer.appendChild(featureTitle);

              featureInfoElement.appendChild(featureContainer);

              featureInfoElement.style.display = "block";
            } else {
            }
          }
        });
      }

      function queryHOBLayer(lat, lon) {
        var queryUrl =
          "https://mapprod3.environment.nsw.gov.au/arcgis/rest/services/Planning/Principal_Planning_Layers/MapServer/7/query";
        var params = {
          distance: 10,
          units: "esriSRUnit_Meter",
          geometry: lon + "," + lat,
          geometryType: "esriGeometryPoint",
          inSR: 4326,
          spatialRel: "esriSpatialRelIntersects",
          returnGeometry: true,
          returnTrueCurves: false,
          returnIdsOnly: false,
          returnCountOnly: false,
          returnZ: false,
          returnM: false,
          returnDistinctValues: false,
          returnExtentsOnly: false,
          outFields: "*",
          f: "geojson",
        };

        $.ajax({
          url: queryUrl,
          data: params,
          dataType: "json",
          success: function (response) {
            var featureInfoElement = document.getElementById("hobInfo");

            featureInfoElement.innerHTML = "";

            if (response.features.length > 0) {
              var feature = response.features[0];
              var properties = feature.properties;
              var featureContainer = document.createElement("div");
              featureContainer.className = "feature-container";

              var featureTitle = document.createElement("p");
              featureTitle.textContent = "HOB: " + properties.MAX_B_H;

              featureContainer.appendChild(featureTitle);

              featureInfoElement.appendChild(featureContainer);

              featureInfoElement.style.display = "block";
            } else {
            }
          }
        });
      }

      function queryMLSLayer(lat, lon) {
        var queryUrl =
          "https://mapprod3.environment.nsw.gov.au/arcgis/rest/services/Planning/Principal_Planning_Layers/MapServer/14/query";
        var params = {
          distance: 10,
          units: "esriSRUnit_Meter",
          geometry: lon + "," + lat,
          geometryType: "esriGeometryPoint",
          inSR: 4326,
          spatialRel: "esriSpatialRelIntersects",
          returnGeometry: true,
          returnTrueCurves: false,
          returnIdsOnly: false,
          returnCountOnly: false,
          returnZ: false,
          returnM: false,
          returnDistinctValues: false,
          returnExtentsOnly: false,
          outFields: "*",
          f: "geojson",
        };

        $.ajax({
          url: queryUrl,
          data: params,
          dataType: "json",
          success: function (response) {
            var featureInfoElement = document.getElementById("mlsInfo");

            featureInfoElement.innerHTML = "";

            if (response.features.length > 0) {
              var feature = response.features[0];
              var properties = feature.properties;
              var featureContainer = document.createElement("div");
              featureContainer.className = "feature-container";

              var featureTitle = document.createElement("p");
              featureTitle.textContent = "MLS: " + properties.LOT_SIZE;

              featureContainer.appendChild(featureTitle);

              featureInfoElement.appendChild(featureContainer);

              featureInfoElement.style.display = "block";
            } else {
            }
          }
        });
      }

      map.on("click", function (e) {
        var lat = e.lngLat.lat;
        var lon = e.lngLat.lng;

        queryCadastreLayer(lat, lon);
        queryAdminLayer(lat, lon);
        queryZoningLayer(lat, lon);
        queryFSRLayer(lat, lon);
        queryHOBLayer(lat, lon);
        queryMLSLayer(lat, lon);
      });

      map.on("load", function () {
        map.addSource("cadastre-raster-tiles", {
          type: "raster",
          tiles: [
            "https://maps.six.nsw.gov.au/arcgis/rest/services/sixmaps/Cadastre/MapServer/export?dpi=96&transparent=true&format=png32&bbox={bbox-epsg-3857}&bboxSR=3857&imageSR=3857&size=256%2C256&f=image&layers=show:0",
          ],
          tileSize: 256,
        });

        map.addLayer({
          id: "cadastre-raster-layer",
          slot: 'middle',
          type: "raster",
          source: "cadastre-raster-tiles",
          minzoom: 0,
          maxzoom: 22,
          layout: {
            visibility: "none",
          },
          paint: {
            'raster-contrast': 0.8
          }
        });

        map.addSource("mapbox-satellite", {
          type: "raster",
          url: "mapbox://mapbox.satellite",
          tileSize: 256,
        });

        map.addLayer({
          id: "mapbox-satellite-layer",
          type: "raster",
          slot: "middle",
          source: "mapbox-satellite",
          layout: {
              visibility: "none",
          },
      });

        map.addSource("land-zoning-raster-tiles", {
          type: "raster",
          tiles: [
            "https://mapprod1.environment.nsw.gov.au/arcgis/rest/services/Planning/EPI_Primary_Planning_Layers/MapServer//export?f=image&dpi=96&transparent=true&format=png32&bboxSR=3857&imageSR=3857&size=256%2C256&layers=show%3A2&bbox={bbox-epsg-3857}",
          ],
          tileSize: 256,
        });

        map.addLayer({
          id: "land-zoning-raster-layer",
          type: "raster",
          slot: 'middle',
          source: "land-zoning-raster-tiles",
          minzoom: 0,
          maxzoom: 22,
          layout: {
            visibility: "none",
          },
          paint: {
            'raster-contrast': 0.9
          }
        });

        map.addSource("floor-space-ratio-raster-tiles", {
          type: "raster",
          tiles: [
            "https://mapprod3.environment.nsw.gov.au/arcgis/rest/services/Planning/Principal_Planning_Layers/MapServer/export?dpi=96&transparent=true&format=png32&bbox={bbox-epsg-3857}&bboxSR=3857&imageSR=3857&size=256%2C256&f=image&layers=show:4",
          ],
          tileSize: 256,
        });

        map.addLayer({
          id: "floor-space-ratio-raster-layer",
          type: "raster",
          slot: 'middle',
          source: "floor-space-ratio-raster-tiles",
          minzoom: 0,
          maxzoom: 22,
          layout: {
            visibility: "none",
          },
          paint: {
            'raster-contrast': 0.9
          }
        });

        map.addSource("mls-raster-tiles", {
          type: "raster",
          tiles: [
            "https://mapprod3.environment.nsw.gov.au/arcgis/rest/services/Planning/Principal_Planning_Layers/MapServer/export?dpi=96&transparent=true&format=png32&bbox={bbox-epsg-3857}&bboxSR=3857&imageSR=3857&size=256%2C256&f=image&layers=show:14",
          ],
          tileSize: 256,
        });

        map.addLayer({
          id: "mls-raster-layer",
          type: "raster",
          slot: 'middle',
          source: "mls-raster-tiles",
          minzoom: 0,
          maxzoom: 22,
          layout: {
            visibility: "none",
          },
          paint: {
            'raster-contrast': 0.9
          }
        });

        map.addSource("heritage-raster-tiles", {
          type: "raster",
          tiles: [
            "https://mapprod3.environment.nsw.gov.au/arcgis/rest/services/Planning/Principal_Planning_Layers/MapServer/export?dpi=96&transparent=true&format=png32&bbox={bbox-epsg-3857}&bboxSR=3857&imageSR=3857&size=256%2C256&f=image&layers=show:8",
          ],
          tileSize: 256,
        });

        map.addLayer({
          id: "heritage-raster-layer",
          type: "raster",
          slot: 'middle',
          source: "heritage-raster-tiles",
          minzoom: 0,
          maxzoom: 22,
          layout: {
            visibility: "none",
          },
          paint: {
            'raster-contrast': 0.9
          }
        });

        map.addSource("hob-raster-tiles", {
          type: "raster",
          tiles: [
            "https://mapprod3.environment.nsw.gov.au/arcgis/rest/services/Planning/Principal_Planning_Layers/MapServer/export?dpi=96&transparent=true&format=png32&bbox={bbox-epsg-3857}&bboxSR=3857&imageSR=3857&size=256%2C256&f=image&layers=show:7",
          ],
          tileSize: 256,
        });

        map.addLayer({
          id: "hob-raster-layer",
          type: "raster",
          slot: 'middle',
          source: "hob-raster-tiles",
          minzoom: 0,
          maxzoom: 22,
          layout: {
            visibility: "none",
          },
          paint: {
            'raster-contrast': 0.9
          }
        });

        map.addSource("bushfire-raster-tiles", {
          type: "raster",
          tiles: [
            "https://mapprod3.environment.nsw.gov.au/arcgis/rest/services/ePlanning/Planning_Portal_Hazard/MapServer//export?f=image&dpi=96&transparent=true&format=png32&bboxSR=3857&imageSR=3857&size=256%2C256&layers=show%3A229&bbox={bbox-epsg-3857}",
          ],
          tileSize: 256,
        });

        map.addLayer({
          id: "bushfire-raster-layer",
          type: "raster",
          slot: 'middle',
          source: "bushfire-raster-tiles",
          minzoom: 0,
          maxzoom: 22,
          layout: {
            visibility: "none",
          },
          paint: {
            'raster-contrast': 0.9
          }
        });

        map.addSource("admin-raster-tiles", {
          type: "raster",
          tiles: [
            "https://maps.six.nsw.gov.au/arcgis/rest/services/public/NSW_Administrative_Boundaries/MapServer/export?f=image&dpi=96&transparent=true&format=png32&bboxSR=3857&imageSR=3857&size=256%2C256&layers=show%3A0&bbox={bbox-epsg-3857}",
          ],
          tileSize: 256,
        });

        map.addLayer({
          id: "admin-raster-layer",
          type: "raster",
          slot: 'middle',
          source: "admin-raster-tiles",
          minzoom: 0,
          maxzoom: 22,
          layout: {
            visibility: "none",
          },
          paint: {
            'raster-contrast': 0.9
          }
        });

        map.addSource("Property Sales public/Valuation", {
          type: "raster",
          tiles: [
          "https://maps.six.nsw.gov.au/arcgis/rest/services/public/Valuation/MapServer//export?f=image&dpi=96&transparent=true&format=png32&bboxSR=3857&imageSR=3857&size=256%2C256&layers=show%3A1%2C2%2C3&bbox={bbox-epsg-3857}",
          ],
          tileSize: 256,
        });

        map.addLayer({
          id: "Property Sales public/Valuation",
          type: "raster",
          slot: 'top',
          source: "Property Sales public/Valuation",
          minzoom: 0,
          maxzoom: 22,
          layout: {
            visibility: "none",
          },
          paint: {
            'raster-contrast': 0.9
          }
        });

        map.addSource("ClimateZones", {
          type: "geojson",
          data: "/static/images/raw-data.json",
        });

        map.addLayer({
          id: "ClimateZones",
          type: "fill",
          slot: 'middle',
          source: "ClimateZones",
          layout: {
            visibility: "none",
          },
          paint: {
            'fill-color': [
              'match',
              ['get', 'climate'],
              'BSk Arid-Steppe-Cold', '#ffdb63',
              'Dfa Cold-Withouth_dry_season-Hot_Summer', '#00ffff',
              'Dfb Cold-Withouth_dry_season-Warm_Summer', '#38c7ff',
              'Csb Temperate-Dry_Summer-Warm_Summer', '#c7c700',
              'BSh Arid-Steppe-Hot', '#f5a300',
              'BWh Arid-Desert-Hot', '#ff0000',
              'Cfa Temperate-Withouth_dry_season-Hot_Summer', '#c7ff4f',
              'Cfb Temperate-Withouth_dry_season-Warm_Summer', '#66ff33',
              'Csa Temperate-Dry_Summer-Hot_Summer', '#ffff00',
              'Dsb Cold-Dry_Summer-Warm_Summer', '#c700c7',
              'Dfd', '#00455e',
              'Cwa Temperate-Dry_Winter-Hot_Summer', '#96ff96',
              'Cwb Temperate-Dry_Winter-Warm_Summer', '#63c763',
              'Cwc Temperate-Dry_Winter-Cold_Summer', '#329632',
              'Aw Tropical-Savanna', '#46a9fa',
              'Af Tropical-Rainforest', '#0000ff',
              'Dsa Cold-Dry_Summer-Hot_Summer', '#ff00ff',
              'Am Tropical-Monsoon', '#0077ff',
              'Dfc Cold-Withouth_dry_season-Cold_Summer', '#007d7d',
              'Dsc Cold-Dry_Summer-Cold_Summer', '#963296',
              'Dwb Cold-Dry_Winter-Warm_Summer', '#5a78db',
              'Dwa Cold-Dry_Winter-Hot_Summer', '#abb0ff',
              'Cfc Temperate-Withouth_dry_season-Cold_Summer', '#32c700',
              'Dwc Cold-Dry_Winter-Cold_Summer', '#32c700',
              'Dsd Cold-Dry_Summer-Very_Cold_Winter', '#966596',
              'Dwd Cold-Dry_Winter-Very_Cold_Winter', '#320087',
              'ET Polar-Tundra', '#b2b2b2',
              'EF Polar-Frost', '#686868',
              'BWk Arid-Desert-Cold', '#ff9696',
              /* Default */ '#ffffff' // Set a default color in case there's no match
            ],
            'fill-opacity': 0.8,
            'fill-emissive-strength': 1,
          },
        });

        function getLinkForClimateZone(climateZone) {
          switch (climateZone) {
              case 'Af Tropical-Rainforest':
                  return 'https://www.callisonrtkl.com/climate-scout/zone/af_tropical-rainforest/';
              case 'Am Tropical-Monsoon':
                  return 'https://www.callisonrtkl.com/climate-scout/zone/am_tropical-monsoon/';
              case 'As Tropical-Savanna':
                  return 'https://www.callisonrtkl.com/climate-scout/zone/as_tropical-savanna-dry-summer/';
              case 'Aw Tropical-Savanna':
                  return 'https://www.callisonrtkl.com/climate-scout/zone/aw_tropical-savanna-dry-winter/';
              case 'BSh Arid-Steppe-Hot':
                  return 'https://www.callisonrtkl.com/climate-scout/zone/bsh_hot-semi-arid/';
              case 'BSk Arid-Steppe-Cold':
                  return 'https://www.callisonrtkl.com/climate-scout/zone/bsk_cold-semi-arid/';
              case 'BWh Arid-Desert-Hot':
                  return 'https://www.callisonrtkl.com/climate-scout/zone/bwh_hot-desert/';
              case 'BWk Arid-Desert-Cold':
                  return 'https://www.callisonrtkl.com/climate-scout/zone/bwk_cold-desert/';
              case 'Cfa Temperate-Withouth_dry_season-Hot_Summer':
                  return 'https://www.callisonrtkl.com/climate-scout/zone/cfa_humid-subtropical/';
              case 'Cfb Temperate-Withouth_dry_season-Warm_Summer':
                  return 'https://www.callisonrtkl.com/climate-scout/zone/cfb_temperate-oceanic/';
              case 'Cfc Temperate-Withouth_dry_season-Cold_Summer':
                  return 'https://www.callisonrtkl.com/climate-scout/zone/cfc_subpolar-oceanic/';
              case 'Csa Temperate-Dry_Summer-Hot_Summer':
                  return 'https://www.callisonrtkl.com/climate-scout/zone/csa_hot-summer-mediterranean/';
              case 'Csb Temperate-Dry_Summer-Warm_Summer':
                  return 'https://www.callisonrtkl.com/climate-scout/zone/csb_warm-summer-mediterranean/';
              case 'Csc':
                  return 'https://www.callisonrtkl.com/climate-scout/zone/csc_cold-summer-mediterranean/';
              case 'Cwa Temperate-Dry_Winter-Hot_Summer':
                  return 'https://www.callisonrtkl.com/climate-scout/zone/cwa_monsoon-influenced-humid-subtropical/';
              case 'Cwb Temperate-Dry_Winter-Warm_Summer':
                  return 'https://www.callisonrtkl.com/climate-scout/zone/cwb_subtropical-highland/';
              case 'Cwc Temperate-Dry_Winter-Cold_Summer':
                  return 'https://www.callisonrtkl.com/climate-scout/zone/cwc_cold-subtropical-highland/';
              case 'Dfa Cold-Withouth_dry_season-Hot_Summer':
                  return 'https://www.callisonrtkl.com/climate-scout/zone/dfa_hot-summer-humid-continental/';
              case 'Dfb Cold-Withouth_dry_season-Warm_Summer':
                  return 'https://www.callisonrtkl.com/climate-scout/zone/dfb_warm-summer-humid-continental/';
              case 'Dfc Cold-Withouth_dry_season-Cold_Summer':
                  return 'https://www.callisonrtkl.com/climate-scout/zone/dfc_subarctic/';
              case 'Dfd':
                  return 'https://www.callisonrtkl.com/climate-scout/zone/dfd_extremely-cold-subarctic/';
              case 'Dsa Cold-Dry_Summer-Hot_Summer':
                  return 'https://www.callisonrtkl.com/climate-scout/zone/dsa_mediterranean-influenced-hot-summer-humid-continental/';
              case 'Dsb Cold-Dry_Summer-Warm_Summer':
                  return 'https://www.callisonrtkl.com/climate-scout/zone/dsb_mediterranean-influenced-warm-summer-humid-continental/';
              case 'Dsc Cold-Dry_Summer-Cold_Summer':
                  return 'https://www.callisonrtkl.com/climate-scout/zone/dsc_mediterranean-influenced-subarctic/';
              case 'Dsd Cold-Dry_Summer-Very_Cold_Winter':
                  return 'https://www.callisonrtkl.com/climate-scout/zone/dsd_mediterranean-influenced-extremely-cold-subarctic/';
              case 'Dwa Cold-Dry_Winter-Hot_Summer':
                  return 'https://www.callisonrtkl.com/climate-scout/zone/dwa_monsoon-influenced-hot-summer-humid-continental/';
              case 'Dwb Cold-Dry_Winter-Warm_Summer':
                  return 'https://www.callisonrtkl.com/climate-scout/zone/dwb_monsoon-influenced-warm-summer-humid-continental/';
              case 'Dwc Cold-Dry_Winter-Cold_Summer':
                  return 'https://www.callisonrtkl.com/climate-scout/zone/dwc_monsoon-influenced-subarctic/';
              case 'Dwd Cold-Dry_Winter-Very_Cold_Winter':
                  return 'https://www.callisonrtkl.com/climate-scout/zone/dwd_monsoon-influenced-extremely-cold-subarctic/';
              case 'EF Polar-Frost':
                  return 'https://www.callisonrtkl.com/climate-scout/zone/ef_ice-cap/';
              case 'ET Polar-Tundra':
                  return 'https://www.callisonrtkl.com/climate-scout/zone/et_tundra/';
              default:
                  return 'https://www.callisonrtkl.com/climate-scout/';
          }
      }

        map.on('click', 'ClimateZones', function (e) {
            var clickedFeature = e.features[0];
            var climateZone = clickedFeature.properties.climate;

            var link = getLinkForClimateZone(climateZone);
            window.open(link, '_blank');
        });

        map.on('mouseenter', 'climateLayer', function () {
            map.getCanvas().style.cursor = 'pointer';
        });

        map.on('mouseleave', 'climateLayer', function () {
            map.getCanvas().style.cursor = '';
        });

        map.addLayer({
          id: "3d-buildings",
          source: "composite",
          "source-layer": "building",
          filter: ["==", "extrude", "true"],
          type: "fill-extrusion",
          minzoom: 15,
          paint: {
            "fill-extrusion-color": "#aaa",
            "fill-extrusion-height": ["get", "height"],
            "fill-extrusion-base": ["get", "min_height"],
            "fill-extrusion-opacity": 1.0,
          },
          layout: {
            visibility: "visible",
          },
        });

        map.addSource("nativelands-source", {
          type: "vector",
          url: "mapbox://nativeland.cjh3mywgg04aaahpidhgio50e-9ctzy",
        });

        map.addLayer({
          id: "Territories",
          type: "fill",
          slot: 'middle',
          source: "nativelands-source",
          "source-layer": "Territories",
          paint: {
            "fill-color": ["get", "color"],
            "fill-opacity": 1,
            'fill-emissive-strength': 1,
          },
          minzoom: 0,
          maxzoom: 22,
          layout: {
            visibility: "none",
          },
        });

        map.addLayer({
          id: "Territories-labels",
          type: "symbol",
          source: "nativelands-source",
          "source-layer": "Territories",
          layout: {
            "text-field": [
              "to-string",
              [
                "get",
                "Name"
              ]
            ],
            "text-font": [
              "Open Sans ExtraBold",
              "Arial Unicode MS Regular"
            ],
            "text-size": 15,
          },
          paint: {
            "text-color": "#ffffff",
            "text-emissive-strength": 1,
          },
          minzoom: 0,
          maxzoom: 22,
          layout: {
            visibility: "none",
          },
        });

        buildingsToggleBtn.classList.add("active");

      });

      const geocoder = new MapboxGeocoder({
        accessToken: mapboxgl.accessToken,
        mapboxgl: mapboxgl,
        marker: true,
      });

      map.addControl(geocoder);

      var marker;
      function mapClickFn(coordinates, addressFieldId) {
        const url =
          "https://api.mapbox.com/geocoding/v5/mapbox.places/" +
          coordinates.lng +
          "," +
          coordinates.lat +
          ".json?access_token=" +
          mapboxgl.accessToken +
          "&types=address";

        $.get(url, function (data) {
          if (data.features.length > 0) {
            const address = data.features[0].place_name;
            $("#" + addressFieldId).val(address);
          }
        });
      }

      map.on("click", function (e) {
        if (marker) {
          marker.remove();
        }

        marker = new mapboxgl.Marker({
          color: "#FFD700",
          circleRadius: 8,
          draggable: false,
        })
          .setLngLat(e.lngLat)
          .addTo(map);

        mapClickFn(e.lngLat, "address_planning");
        mapClickFn(e.lngLat, "address_geometry");
        mapClickFn(e.lngLat, "address_elevated");
        mapClickFn(e.lngLat, "address_lite");
        mapClickFn(e.lngLat, "address_speckle");
        mapClickFn(e.lngLat, "address_images");
      });

      const cadastreToggleBtn = document.getElementById("cadastreToggle");
      const landZoningToggleBtn = document.getElementById("landZoningToggle");
      const floorSpaceRatioToggleBtn = document.getElementById("fsrToggle");
      const mlsToggleBtn = document.getElementById("mlsToggle");
      const adminToggleBtn = document.getElementById("adminToggle");
      const hobToggleBtn = document.getElementById("hobToggle");
      const bushfireToggleBtn = document.getElementById("bushfireToggle");
      const heritageToggleBtn = document.getElementById("heritageToggle");
      const buildingsToggleBtn = document.getElementById("buildingsToggle");
      const nativelandsToggleBtn = document.getElementById("nativelandsToggle");
      const satelliteToggleBtn = document.getElementById("satelliteToggle");
      const valuationToggleBtn = document.getElementById("valuationToggle");
      const climatezoneToggleBtn = document.getElementById("climatezoneToggle");

      cadastreToggleBtn.addEventListener("click", function () {
        const layerId = "cadastre-raster-layer";
        toggleLayerVisibility(layerId, cadastreToggleBtn);
      });

      landZoningToggleBtn.addEventListener("click", function () {
        const layerId = "land-zoning-raster-layer";
        toggleLayerVisibility(layerId, landZoningToggleBtn);
      });

      floorSpaceRatioToggleBtn.addEventListener("click", function () {
        const layerId = "floor-space-ratio-raster-layer";
        toggleLayerVisibility(layerId, floorSpaceRatioToggleBtn);
      });

      mlsToggleBtn.addEventListener("click", function () {
        const layerId = "mls-raster-layer";
        toggleLayerVisibility(layerId, mlsToggleBtn);
      });

      adminToggleBtn.addEventListener("click", function () {
        const layerId = "admin-raster-layer";
        toggleLayerVisibility(layerId, adminToggleBtn);
      });

      hobToggleBtn.addEventListener("click", function () {
        const layerId = "hob-raster-layer";
        toggleLayerVisibility(layerId, hobToggleBtn);
      });

      bushfireToggleBtn.addEventListener("click", function () {
        const layerId = "bushfire-raster-layer";
        toggleLayerVisibility(layerId, bushfireToggleBtn);
      });

      heritageToggleBtn.addEventListener("click", function () {
        const layerId = "heritage-raster-layer";
        toggleLayerVisibility(layerId, heritageToggleBtn);
      });

      buildingsToggleBtn.addEventListener("click", function () {
        const layerId = "3d-buildings";
        toggleLayerVisibility(layerId, buildingsToggleBtn);
      });

      nativelandsToggleBtn.addEventListener("click", function () {
        const layerId1 = "Territories";
        const layerId2 = "Territories-labels";
        toggleLayerVisibility(layerId1, nativelandsToggleBtn);
        toggleLayerVisibility(layerId2, nativelandsToggleBtn);
      });

      satelliteToggleBtn.addEventListener("click", function () {
        const layerId = "mapbox-satellite-layer";
        toggleLayerVisibility(layerId, satelliteToggleBtn);
      });

      valuationToggleBtn.addEventListener("click", function () {
        const layerId = "Property Sales public/Valuation";
        toggleLayerVisibility(layerId, valuationToggleBtn);
      });

      climatezoneToggleBtn.addEventListener("click", function () {
        const layerId = "ClimateZones";
        toggleLayerVisibility(layerId, climatezoneToggleBtn);
        toggleLegendVisibility(layerId);
      });

      function toggleLayerVisibility(layerId, toggleBtn) {
        const visibility = map.getLayoutProperty(layerId, "visibility");
        if (visibility === "visible") {
          map.setLayoutProperty(layerId, "visibility", "none");
          toggleBtn.classList.remove("active");
        } else {
          map.setLayoutProperty(layerId, "visibility", "visible");
          toggleBtn.classList.add("active");
        }
      }

      function toggleLegendVisibility(layerId) {
        const isClimateZoneLayerVisible =
          map.getLayoutProperty(layerId, "visibility") === "visible";

        if (isClimateZoneLayerVisible) {
          $(".legend").show();
        } else {
          $(".legend").hide();
        }

    }

    const style = document.createElement("style");
    style.innerHTML = ".legend { display: none; }";
    document.head.appendChild(style);

    </script>

    <script>
      document
        .getElementById("uploadedMergeFile")
        .addEventListener("change", function () {
          if (this.value) {
            document.querySelector(".uploadMergeLabel").classList.add("green");
          } else {
            document
              .querySelector(".uploadMergeLabel")
              .classList.remove("green");
          }
        });

      function countFiles() {
        var input = document.getElementById("uploadedMergeFile");
        var fileCount = input.files.length;
        var countDisplay = document.getElementById("fileCount");
        countDisplay.textContent = fileCount.toString();
      }
    </script>

    <script>
      document
        .getElementById("uploadGiraffeBtn")
        .addEventListener("change", function () {
          if (this.value) {
            document
              .querySelector(".uploadGiraffeLabel")
              .classList.add("green");
          } else {
            document
              .querySelector(".uploadGiraffeLabel")
              .classList.remove("green");
          }
        });
    </script>
  </body>
</html>
